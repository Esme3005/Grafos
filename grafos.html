<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Aplicaciones de Teoría de Grafos — Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
    body {
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: linear-gradient(135deg, #1e1e2f, #3e3e5e);
      color: #f8fafc;
      margin:0;
    }
    .tab-btn { transition: all .18s ease; color:#cbd5e1; }
    .tab-btn.active { border-bottom-color:#3b82f6; color:#38bdf8; transform: translateY(-2px); }
    .card {
      border-radius:14px;
      background: rgba(255,255,255,0.05);
      box-shadow:0 8px 30px rgba(2,6,23,0.3);
      padding:20px;
    }
    canvas {
      background:#1e1e2f;
      border-radius:10px;
      border:1px solid #475569;
    }
    .small { font-size:.95rem; color:#cbd5e1; }
    .pill {
      background: rgba(255,255,255,0.05);
      border-radius:8px;
      padding:.3rem .6rem;
      border:1px solid #475569;
      color:#f8fafc;
    }
    button.bg-blue-600 { background: linear-gradient(135deg,#3b82f6,#0ea5e9); color:white; }
    button.bg-blue-600:hover { background: linear-gradient(135deg,#0ea5e9,#3b82f6); }
    button.bg-green-600 { background: linear-gradient(135deg,#22c55e,#16a34a); color:white; }
    button.bg-green-600:hover { background: linear-gradient(135deg,#16a34a,#22c55e); }
    button.bg-purple-600 { background: linear-gradient(135deg,#a78bfa,#7c3aed); color:white; }
    button.bg-purple-600:hover { background: linear-gradient(135deg,#7c3aed,#a78bfa); }
    footer { text-align:center; padding:15px; font-size:.9em; background: rgba(0,0,0,0.3); margin-top:20px; }
  </style>
</head>
<body>
  <div class="max-w-6xl mx-auto p-6">
    <header class="text-center mb-8">
      <h1 class="text-4xl font-bold tracking-tight">Aplicaciones de Teoría de Grafos</h1>
      <p class="small mt-2">Guía interactiva para explorar redes, flujos y optimización.</p>
    </header>

    <!-- Tabs -->
    <div class="sticky top-4 mb-6">
      <nav class="rounded-xl card p-2">
        <ul id="tabs" class="flex items-center justify-center gap-4">
          <li><button class="tab-btn active px-4 py-2 font-semibold" data-tab="comunicacion">Redes y Rutas</button></li>
          <li><button class="tab-btn px-4 py-2 font-semibold" data-tab="flujo">Redes de Flujo</button></li>
          <li><button class="tab-btn px-4 py-2 font-semibold" data-tab="mst">Árbol de Expansión Mínima</button></li>
        </ul>
      </nav>
    </div>

    <main>
      <!-- Dijkstra -->
      <section id="comunicacion" class="tab-panel active card mb-6">
        <div class="grid md:grid-cols-5 gap-6 items-start">
          <div class="md:col-span-3">
            <h2 class="text-2xl font-bold text-blue-400 mb-3">1. Simulación del Algoritmo de Dijkstra</h2>
            <p class="small mb-3">Encuentra la ruta más eficiente en redes de vértices y aristas con pesos.</p>
            <div class="mt-4">
              <label class="small mr-2">Inicio:</label>
              <select id="start-node" class="pill"></select>
              <label class="small ml-3 mr-2">Fin:</label>
              <select id="end-node" class="pill"></select>
              <button id="run-btn" class="btn bg-blue-600 ml-4">Ejecutar</button>
              <button id="reset-btn" class="btn bg-gray-700 ml-2">Resetear</button>
            </div>
            <div class="mt-4 small">
              <strong>Resultado:</strong> <span id="result-text">—</span>
            </div>
          </div>
          <div class="md:col-span-2">
            <canvas id="graph-canvas" width="480" height="360"></canvas>
          </div>
        </div>
      </section>

      <!-- Flow -->
      <section id="flujo" class="tab-panel card mb-6" style="display:none">
        <div class="grid md:grid-cols-5 gap-6 items-start">
          <div class="md:col-span-3">
            <h2 class="text-2xl font-bold text-green-400 mb-3">2. Redes de Flujo (Edmonds–Karp)</h2>
            <div class="mt-3">
              <label class="small mr-2">Fuente:</label>
              <select id="flow-source" class="pill"></select>
              <label class="small ml-3 mr-2">Sumidero:</label>
              <select id="flow-sink" class="pill"></select>
              <button id="flow-run" class="btn bg-green-600 ml-4">Ejecutar Flujo Máximo</button>
              <button id="flow-reset" class="btn bg-gray-700 ml-2">Resetear</button>
            </div>
            <div class="mt-4 small">
              <strong>Flujo:</strong> <span id="flow-result">—</span>
            </div>
          </div>
          <div class="md:col-span-2">
            <canvas id="flow-canvas" width="480" height="360"></canvas>
          </div>
        </div>
      </section>

      <!-- MST -->
      <section id="mst" class="tab-panel card mb-6" style="display:none">
        <div class="grid md:grid-cols-5 gap-6 items-start">
          <div class="md:col-span-3">
            <h2 class="text-2xl font-bold text-purple-400 mb-3">3. Árbol de Expansión Mínima (Kruskal)</h2>
            <div class="mt-3">
              <button id="mst-run" class="btn bg-purple-600">Ejecutar Kruskal</button>
              <button id="mst-reset" class="btn bg-gray-700 ml-2">Resetear</button>
            </div>
            <div class="mt-4 small">
              <strong>Peso total:</strong> <span id="mst-result">—</span>
            </div>
          </div>
          <div class="md:col-span-2">
            <canvas id="mst-canvas" width="480" height="360"></canvas>
          </div>
        </div>
      </section>

      <footer class="small card mt-6">
        Desarrollado por <strong>Esmeralda Betsabet Montalvo Martínez</strong>
      </footer>
    </main>
  </div>

<script>
// ================== TAB NAVIGATION ==================
document.querySelectorAll('#tabs .tab-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('#tabs .tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const id = btn.dataset.tab;
    document.querySelectorAll('.tab-panel').forEach(p=>p.style.display=p.id===id?'block':'none');
  });
});

// ================== COMMON NODES & EDGES ==================
const baseNodes=[
  {id:'A', x:80, y:200},{id:'B', x:200, y:80},{id:'C', x:200, y:320},
  {id:'D', x:340, y:80},{id:'E', x:340, y:320},{id:'F', x:460, y:200},
];
const baseEdges=[
  {from:'A',to:'B',w:7},{from:'A',to:'C',w:9},{from:'B',to:'C',w:10},{from:'B',to:'D',w:15},
  {from:'C',to:'E',w:11},{from:'D',to:'E',w:6},{from:'D',to:'F',w:9},{from:'E',to:'F',w:12}
];
function drawCanvas(canvas,nodes,edges){
  const ctx=canvas.getContext('2d'); ctx.clearRect(0,0,canvas.width,canvas.height);
  const nodeR=18;
  edges.forEach(e=>{
    const a=nodes.find(n=>n.id===e.from), b=nodes.find(n=>n.id===e.to);
    ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y);
    ctx.strokeStyle=e.color||'#94a3b8'; ctx.lineWidth=e.width||3; ctx.stroke();
    const mx=(a.x+b.x)/2, my=(a.y+b.y)/2;
    ctx.fillStyle='#cbd5e1'; ctx.font='12px Inter, sans-serif'; ctx.textAlign='center';
    ctx.fillText(e.label||e.w,mx,my-10);
  });
  nodes.forEach(n=>{
    ctx.beginPath(); ctx.arc(n.x,n.y,nodeR,0,2*Math.PI);
    ctx.fillStyle=n.color||'#475569'; ctx.fill();
    ctx.lineWidth=3; ctx.strokeStyle='#f8fafc'; ctx.stroke();
    ctx.fillStyle='#fff'; ctx.font='bold 14px Inter, sans-serif'; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText(n.id,n.x,n.y);
  });
}

// ================== Dijkstra ==================
const dCanvas=document.getElementById('graph-canvas');
const startSel=document.getElementById('start-node');
const endSel=document.getElementById('end-node');
const runBtn=document.getElementById('run-btn');
const resetBtn=document.getElementById('reset-btn');
const resultText=document.getElementById('result-text');
const dNodes=baseNodes.map(n=>({...n})), dEdges=baseEdges.map(e=>({...e}));
function initDijkstraUI(){
  startSel.innerHTML=''; endSel.innerHTML='';
  dNodes.forEach(n=>{startSel.add(new Option(n.id,n.id)); endSel.add(new Option(n.id,n.id));});
  endSel.value='F';
  drawCanvas(dCanvas,dNodes,dEdges);
  resultText.textContent='—';
}
initDijkstraUI();
function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
async function runDijkstra(startId,endId){
  runBtn.disabled=true; resetBtn.disabled=true; resultText.textContent='Calculando...';
  const adj={}; dNodes.forEach(n=>adj[n.id]=[]);
  dEdges.forEach(e=>{ adj[e.from].push({to:e.to,w:e.w}); adj[e.to].push({to:e.from,w:e.w}); });
  const dist={}, prev={}; dNodes.forEach(n=>dist[n.id]=Infinity); dist[startId]=0;
  const Q=new Set(dNodes.map(n=>n.id));
  while(Q.size){
    let u=null, md=Infinity;
    for(const q of Q) if(dist[q]<md){md=dist[q]; u=q;}
    if(u===null) break; Q.delete(u);
    for(const nb of adj[u]){
      const alt=dist[u]+nb.w;
      if(alt<dist[nb.to]){ dist[nb.to]=alt; prev[nb.to]=u; }
    }
    if(u===endId) break;
  }
  const path=[]; let cur=endId;
  if(prev[cur]||cur===startId){
    while(cur){ const p=prev[cur]; if(p) path.unshift({from:p,to:cur}); cur=p; }
  }
  const finalEdges=dEdges.map(e=>({...e, color: path.some(p=>(p.from===e.from&&p.to===e.to)||(p.from===e.to&&p.to===e.from))?'#16a34a':'#94a3b8', width: path.some(p=>(p.from===e.from&&p.to===e.to)||(p.from===e.to&&p.to===e.from))?5:3 }));
  const finalNodes=dNodes.map(n=>({...n,color:path.some(p=>p.from===n.id||p.to===n.id)?'#16a34a':'#475569'}));
  drawCanvas(dCanvas,finalNodes,finalEdges);
  resultText.textContent=dist[endId]===Infinity?'No se encontró ruta':`Costo total: ${dist[endId]}`;
  runBtn.disabled=false; resetBtn.disabled=false;
}
runBtn.addEventListener('click',()=>{const s=startSel.value,t=endSel.value;if(s===t){resultText.textContent='Inicio y fin deben ser diferentes';return;} runDijkstra(s,t);});
resetBtn.addEventListener('click',initDijkstraUI);

// ================== FLOWS ==================
const fCanvas=document.getElementById('flow-canvas');
const flowSource=document.getElementById('flow-source');
const flowSink=document.getElementById('flow-sink');
const flowRunBtn=document.getElementById('flow-run');
const flowResetBtn=document.getElementById('flow-reset');
const flowResult=document.getElementById('flow-result');
const fNodes=baseNodes.map(n=>({...n}));
const fEdgesOrig=[
  {from:'A',to:'B',cap:10},{from:'A',to:'C',cap:8},
  {from:'B',to:'C',cap:2},{from:'B',to:'D',cap:9},
  {from:'C',to:'E',cap:11},{from:'D',to:'E',cap:6},
  {from:'D',to:'F',cap:9},{from:'E',to:'F',cap:12}
];
function initFlowUI(){
  flowSource.innerHTML=''; flowSink.innerHTML='';
  fNodes.forEach(n=>{flowSource.add(new Option(n.id,n.id)); flowSink.add(new Option(n.id,n.id));});
  flowSource.value='A'; flowSink.value='F';
  flowResult.textContent='—';
  drawCanvas(fCanvas,fNodes,fEdgesOrig.map(e=>({...e,label:e.cap})));
}
initFlowUI();
async function runEdmondsKarp(source,sink){
  flowRunBtn.disabled=true; flowResetBtn.disabled=true; flowResult.textContent='Calculando...';
  const rcap={}; function key(u,v){return `${u}->${v}`;}
  fEdgesOrig.forEach(e=>{ rcap[key(e.from,e.to)] = (rcap[key(e.from,e.to)]||0)+e.cap; });
  let maxflow=0;
  while(true){
    const queue=[source]; const parent={}; parent[source]=null;
    while(queue.length){
      const u=queue.shift();
      for(const k in rcap){const [a,b]=k.split('->'); if(a!==u) continue;
        if(rcap[k]>0 && parent[b]===undefined){ parent[b]=a; queue.push(b); if(b===sink) break; }}
      if(parent[sink]!==undefined) break;
    }
    if(parent[sink]===undefined) break;
    const path=[]; let v=sink;
    while(v!==source){ const u=parent[v]; path.unshift([u,v]); v=u;}
    let bottleneck=Infinity; path.forEach(([u,v])=>{bottleneck=Math.min(bottleneck,rcap[key(u,v)]);});
    path.forEach(([u,v])=>{rcap[key(u,v)]-=bottleneck; rcap[key(v,u)] = (rcap[key(v,u)]||0)+bottleneck;});
    maxflow+=bottleneck;
    const caps={}; fEdgesOrig.forEach(e=>{ caps[key(e.from,e.to)] = (caps[key(e.from,e.to)]||0)+e.cap; });
    const visualEdges=fEdgesOrig.map(e=>{ const used=(caps[key(e.from,e.to)]||0)-(rcap[key(e.from,e.to)]||0); return {from:e.from,to:e.to,label:`${used}/${e.cap}`,color:'#94a3b8'};});
    drawCanvas(fCanvas,fNodes,visualEdges);
    await sleep(400);
  }
  flowResult.textContent=`Flujo máximo: ${maxflow}`;
  flowRunBtn.disabled=false; flowResetBtn.disabled=false;
}
flowRunBtn.addEventListener('click',()=>{const s=flowSource.value,t=flowSink.value;if(s===t){flowResult.textContent='Fuente y sumidero deben ser distintos';return;} runEdmondsKarp(s,t);});
flowResetBtn.addEventListener('click',initFlowUI);

// ================== MST ==================
const mstCanvas=document.getElementById('mst-canvas');
const mstRunBtn=document.getElementById('mst-run');
const mstResetBtn=document.getElementById('mst-reset');
const mstResult=document.getElementById('mst-result');
const mNodes=baseNodes.map(n=>({...n})), mEdges=baseEdges.map((e,i)=>({...e,id:'e'+i}));
function initMSTUI(){ mstResult.textContent='—'; drawCanvas(mstCanvas,mNodes,mEdges); }
initMSTUI();
async function runKruskal(){
  mstRunBtn.disabled=true; mstResetBtn.disabled=true;
  const items=mEdges.slice().sort((a,b)=>a.w-b.w);
  const parent={}; mNodes.forEach(n=>parent[n.id]=n.id);
  function find(x){return parent[x]===x?x:(parent[x]=find(parent[x]));}
  function union(a,b){parent[find(a)]=find(b);}
  const selected=[]; let total=0;
  for(const it of items){
    if(find(it.from)!==find(it.to)){union(it.from,it.to); selected.push(it); total+=it.w;}
  }
  const finalEdges=mEdges.map(e=>({...e,color:selected.some(s=>(s.from===e.from&&s.to===e.to)||(s.from===e.to&&s.to===e.from))?'#7c3aed':'#94a3b8', width:selected.some(s=>(s.from===e.from&&s.to===e.to)||(s.from===e.to&&s.to===e.from))?5:3}));
  drawCanvas(mstCanvas,mNodes.map(n=>({...n,color:'#475569'})),finalEdges);
  mstResult.textContent=total;
  mstRunBtn.disabled=false; mstResetBtn.disabled=false;
}
mstRunBtn.addEventListener('click',runKruskal);
mstResetBtn.addEventListener('click',initMSTUI);
</script>
</body>
</html>
